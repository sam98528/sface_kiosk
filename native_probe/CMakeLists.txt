cmake_minimum_required(VERSION 3.16)
project(native_probe CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

add_executable(native_probe
  main.cpp
  edsdk_bridge.cpp
)

# edsdk_bridgeì—ì„œ Windows/COM/WIC ì‚¬ìš©
target_link_libraries(native_probe PRIVATE ole32 windowscodecs)
# EDSDK ê²½ë¡œ
set(EDSDK_ROOT    "${CMAKE_CURRENT_SOURCE_DIR}/windows/third_party/edsdk")
set(EDSDK_BIN_DIR "${EDSDK_ROOT}/bin/x64")
set(EDSDK_LIB_DIR "${EDSDK_ROOT}/lib/x64")

# (ì„ íƒ) .lib ë§í¬
if(EXISTS "${EDSDK_LIB_DIR}/EDSDK.lib")
  target_link_libraries(native_probe PRIVATE "${EDSDK_LIB_DIR}/EDSDK.lib")
endif()

# ğŸ”´ DLL ì¡´ì¬ ì—¬ë¶€ë¥¼ ì‚¬ì „ ì²´í¬í•´ì„œ ëª…í™•í•œ ì—ëŸ¬ë¥¼ ì£¼ì
if(NOT EXISTS "${EDSDK_BIN_DIR}/EDSDK.dll")
  message(FATAL_ERROR "EDSDK.dll not found at: ${EDSDK_BIN_DIR}/EDSDK.dll")
endif()
if(NOT EXISTS "${EDSDK_BIN_DIR}/EdsImage.dll")
  message(FATAL_ERROR "EdsImage.dll not found at: ${EDSDK_BIN_DIR}/EdsImage.dll")
endif()

# ğŸ”µ ë¹Œë“œ í›„ DLL ìë™ ë³µì‚¬ (ê²½ë¡œëŠ” ë°˜ë“œì‹œ ë”°ì˜´í‘œ!)
add_custom_command(TARGET native_probe POST_BUILD
  COMMAND "${CMAKE_COMMAND}" -E copy_if_different
          "${EDSDK_BIN_DIR}/EDSDK.dll"     "$<TARGET_FILE_DIR:native_probe>"
  COMMAND "${CMAKE_COMMAND}" -E copy_if_different
          "${EDSDK_BIN_DIR}/EdsImage.dll"  "$<TARGET_FILE_DIR:native_probe>"
)